---
import { getCollection } from 'astro:content';

const allContent = await getCollection('gate');

// Helper to structure content into Subjects -> Topics -> Pages
// Folder structure: src/content/gate/subject/topic.md or subject/topic/page.md
// Assuming: src/content/gate/[subject]/[topic].md

// Group by subject (first folder name)
const grouped = {};

allContent.forEach((entry) => {
  const parts = entry.slug.split('/');
  if (parts.length >= 1) {
    const subject = parts[0];
    if (!grouped[subject]) {
      grouped[subject] = [];
    }
    grouped[subject].push(entry);
  }
});

const subjects = Object.keys(grouped).sort();

// Capitalize helper
const capitalize = (s) => s.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
---

<nav class="space-y-6">
  {subjects.map(subject => (
    <div>
      <h3 class="font-bold text-slate-900 dark:text-white uppercase tracking-wider text-sm mb-2 px-2">
        {capitalize(subject)}
      </h3>
      <ul class="space-y-1">
        {grouped[subject]
          .sort((a, b) => (a.data.order || 0) - (b.data.order || 0))
          .map(entry => (
          <li>
            <a
              href={`/gate/${entry.slug}`}
              class="block px-2 py-1.5 text-sm text-slate-600 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-slate-50 dark:hover:bg-slate-800 rounded transition-colors"
            >
              {entry.data.title}
            </a>
          </li>
        ))}
      </ul>
    </div>
  ))}
</nav>
